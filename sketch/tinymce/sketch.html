<!doctype html>
<html class="fullheight">
    <head>
        <title>Sketch and Save</title>
        <link href="assets/literallycanvas.css" rel="stylesheet" />
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, user-scalable=no" />

        <style type="text/css">
            .fullheight {
                height: calc(100% - 15px);
                margin: 0;
            }

            .literally .toolbar-at-top {
                background-image: url(assets/img/tpback.png);
            }

            #sketchsubmit {
                width: 100px;
                margin-top: 5px;
                margin-left: 40%;
                margin-right: 40%;
            }
            .literally {
                height: 100%;
                width: 100%;
                position: relative;
            }
        </style>
        <script type="text/javascript" src="js/jquery-1.8.2.js"></script>
        <script type="text/javascript" src="js/tiny_mce_popup.js"></script>
        <script type="text/javascript" src="js/sketch.js"></script>
        <script src="//cdnjs.cloudflare.com/ajax/libs/react/0.14.7/react-with-addons.js"></script>
        <script src="//cdnjs.cloudflare.com/ajax/libs/react/0.14.7/react-dom.js"></script>

        <!-- Literally Canvas -->
        <script type="text/javascript" src="js/literallycanvas.min.js"></script> 
    </head>
    <body class="fullheight">
        <div class="literally"></div>
        <button class="mdl-align" id="sketchsubmit" style="">Insert Sketch</button>
        <script type="text/javascript" >
            $(document).ready(function() {
                var lc = LC.init(document.getElementsByClassName('literally')[0],
                {
                    imageURLPrefix: './assets/img'
                });

                var selected = window.parent.tinyMCE.activeEditor.selection.getNode();
                if (selected.tagName == "IMG") {
                    var newImage = new Image();
                    newImage.src = selected.src;
                    lc.saveShape(LC.createShape('Image', {x: 10, y: 10, image: newImage}));
                }
                
                $('#sketchsubmit').click(function(e) {
                    e.preventDefault();
                    console.log(lc);
                    var imgstring = lc.getImage().toDataURL(),
                        sketch = '<img src="'+imgstring+'" />';
                    window.parent.tinyMCE.activeEditor.execCommand('mceInsertContent', 0, sketch);
                    tinyMCEPopup.close();
                });
            });
        </script>
    </body>
</html>
