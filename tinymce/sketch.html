<!doctype html>
<html class="fullheight">
    <head>
        <title>Sketch and Save</title>
        <link href="assets/literallycanvas.css" rel="stylesheet" />
        <link href="assets/sketch.css" rel="stylesheet" />
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, user-scalable=no, initial-scale=1, maximum-scale=1" />

        <style type="text/css">
            
        </style>
        <script type="text/javascript" src="js/jquery-1.8.2.js"></script>
        <script type="text/javascript" src="js/tiny_mce_popup.js"></script>
        <script src="//cdnjs.cloudflare.com/ajax/libs/react/0.14.7/react-with-addons.js"></script>
        <script src="//cdnjs.cloudflare.com/ajax/libs/react/0.14.7/react-dom.js"></script>

        <!-- Literally Canvas -->
        <script type="text/javascript" src="js/literallycanvas.min.js"></script>
        <script type="text/javascript" src="js/extratools.js"></script>
    </head>
    <body class="fullheight">
        <div class="literally"></div>
        <div class="centerbutton">
            <button class="sketchsubmit" style="">Insert Sketch</button>
        </div>

        <script type="text/javascript" >
            $(document).ready(function() {
                var lc = LC.init(document.getElementsByClassName('literally')[0],
                {
                    imageURLPrefix: './assets/img',
                    tools: LC.defaultTools.concat([regularShapes])
                });

                var selected = window.parent.tinyMCE.activeEditor.selection.getNode();
                if (selected.tagName == "IMG") {
                    var newImage = new Image();
                    newImage.src = selected.src;
                    lc.saveShape(LC.createShape('Image', {x: 10, y: 10, image: newImage}));
                }

                $('.sketchsubmit').click(function(e) {
                    e.preventDefault();

                    var imgstring = lc.getImage().toDataURL(),
                        sketch = '<img src="'+imgstring+'" />';
                    window.parent.tinyMCE.activeEditor.execCommand('mceInsertContent', 0, sketch);
                    tinyMCEPopup.close();
                });

                $('div[role="dialog"]',parent.document).css('top', $(parent.document).scrollTop())
                $('div[role="dialog"]',parent.document).css('left', $(parent.document).scrollLeft());

                $('div[role="dialog"]',parent.document).css('height', 'calc(100% - 0px)');
                $('div[role="dialog"]',parent.document).css('width', 'calc(100% - 0px)');
            });
        </script>
    </body>
</html>